<!--
# Copyright (C) 2008  Georgia Public Library Service / Equinox Software, Inc
# Mike Rylander <miker@esilibrary.com>
# 
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
-->
<!DOCTYPE html PUBLIC 
	"-//W3C//DTD XHTML 1.0 Transitional//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" [
	<!--#include virtual="/opac/locale/${locale}/conify.dtd"-->
]>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>&conify.org_unit.title;</title>

		<style type="text/css">
			@import url('/js/dojo/dojo/resources/dojo.css');
			@import url('/js/dojo/dijit/themes/tundra/tundra.css');
			@import url('/js/dojo/dojox/widget/Toaster/Toaster.css');
		</style>

		<style type="text/css">
			html, body
			{
				height: 100%;
				width: 100%;
				margin: 0px 0px 0px 0px;
				padding: 0px 0px 0px 0px;
				overflow: hidden;
			}

			th
			{
				text-align: right;
				font-weight: bold;
				padding-left: 20px;
				padding-right: 5px;
			}
            /* this is a hack to get the right pane to display
               in recent browsers when using this interface
               embedded in the web staff client
            */
            .dijitLayoutContainer {
                position: static;
            }
		</style>

		<!-- The OpenSRF API writ JS -->
		<script language='javascript' src='/IDL2js' type='text/javascript'></script>
		<script language='javascript' src='/opac/common/js/utils.js' type='text/javascript'></script>
		<script language='javascript' src='/opac/common/js/CGI.js' type='text/javascript'></script>
		<script language='javascript' src='/opac/common/js/JSON_v1.js' type='text/javascript'></script>

		<!-- Dojo goodness -->
		<script type="text/javascript" src="../admin.js"></script>

		<script type="text/javascript" src="/js/dojo/dojo/dojo.js"></script>
		<script type="text/javascript" src="/js/dojo/dijit/dijit.js"></script>

		<script type="text/javascript" src="org_unit.js"></script>

	</head>

	<body class="tundra" id='pagebody'>

		<div dojoType="dijit.layout.SplitContainer" orientation="horizontal" style="height: 100%">

			<div dojoType="dijit.layout.ContentPane" sizeShare="100">
				<script type="dojo/method">
<![CDATA[

                    pcrud.retrieveAll( 'aou', {
                        timeout : 10, order_by : { aou : 'shortname' },
                        onerror : function (r) { status_update(aou_strings.ERROR_FETCHING_ORGS); },
                        oncomplete : function (r) {
                            var _ou_list = r.recv().content();
                            var _ou_data = aou.toStoreData( _ou_list );
                            ou_list_store = new dojo.data.ItemFileWriteStore({ data : _ou_data });

                            ou_list_store.onSet = function (item, attr, o, n) {
                                if (attr == 'ischanged') return;
                                if ((n == o) || ((o == null) && (n == ''))) return;
                                this.setValue( item, 'ischanged', 1);
                            };

                            dojo.addOnUnload( function (event) {

                                ou_list_store.fetch({
                                    query : { ischanged : 1 },
                                    queryOptions : { deep : true },
                                    onItem : function (item, req) {
                                        try {
                                            if (this.isItem( item )) window.dirtyStore.push( item );
                                        } catch (e) {}
                                    },
                                    scope : window.ou_list_store
                                });

                                if (window.dirtyStore.length > 0) {
                                    var confirmation = confirm(aou_strings.CONFIRM_EXIT_AOU);

                                    if (confirmation) {
                                        for (var i in dirtyStore) {
                                            current_ou = window.dirtyStore[i];
                                            save_org(true);
                                        }
                                    }
                                }
                            });
                        }
                    });

                    pcrud.retrieveAll( 'aout', {
                        timeout : 10, order_by : { aout : 'depth' },
                        onerror : function (r) { status_update(aou_strings.ERROR_FETCHING_TYPES_AOUT); },
                        oncomplete : function (r) {
                            window._ou_type_list = r.recv().content();
                            window._ou_type_data = aout.toStoreData( window._ou_type_list );
                            window.ou_type_store = new dojo.data.ItemFileReadStore({ data : window._ou_type_data });
                       }
                    });

					highlighter.ou_tree = {};
					highlighter.editor_pane = {};
					highlighter.hoo_pane = {};
					highlighter.addresses_pane = {};

					highlighter.ou_tree.green = dojox.fx.highlight( { color : '#B4FFB4', node : 'ou_tree', duration : 500 } );
					highlighter.ou_tree.red = dojox.fx.highlight( { color : '#FF2018', node : 'ou_tree', duration : 500 } );

					highlighter.editor_pane.green = dojox.fx.highlight( { color : '#B4FFB4', node : 'editor_pane', duration : 500 } );
					highlighter.editor_pane.red = dojox.fx.highlight( { color : '#FF2018', node : 'editor_pane', duration : 500 } );

					highlighter.hoo_pane.green = dojox.fx.highlight( { color : '#B4FFB4', node : 'hoo_pane', duration : 500 } );
					highlighter.hoo_pane.red = dojox.fx.highlight( { color : '#FF2018', node : 'hoo_pane', duration : 500 } );

					highlighter.addresses_pane.green = dojox.fx.highlight( { color : '#B4FFB4', node : 'addresses_pane', duration : 500 } );
					highlighter.addresses_pane.red = dojox.fx.highlight( { color : '#FF2018', node : 'addresses_pane', duration : 500 } );
]]>
				</script>
				<div
				  id="ou_tree"
				  label="&conify.org_unit.ou_tree.label;"
				  query="{'_top':'true'}"
				  dojoType="dijit.Tree"
				  store="ou_list_store"
				  minSize="200"
				  jsId="ou_tree"
				>

					<script type="dojo/method" event="onClick" args="item,node">
<![CDATA[
						right_pane_toggler.show();

						current_ou = item;
						window.current_fm_ou = new aou().fromStoreItem(item);

						highlighter.editor_pane.green.play();
						status_update( dojo.string.substitute( aou_strings.STATUS_EDITING, [this.store.getValue( item, 'name' )] ) );

						new_kid_button.disabled = false;
						save_ou_button.disabled = false;
						delete_ou_button.disabled = false;

						dojo.byId('current_ou_name').innerHTML = this.store.getValue( current_ou, 'name' );

						var main_settings_fields = [ 'name', 'shortname', 'routing_code', 'email', 'phone', 'ou_type' ];
						for ( var i in main_settings_fields ) {
							var field = main_settings_fields[i];
							var value = this.store.getValue( current_ou, field );

							if (!value) {
								window["editor_pane_" + field].setValue( '' ); // unset the value
								window["editor_pane_" + field].setDisplayedValue( '' ); // unset the value
							} else window["editor_pane_" + field].setValue( value );
						}

						if ( this.store.getValue( current_ou, '_trueRoot' ) == 'true' ) {
							editor_pane_parent_ou.disabled = true;
							editor_pane_parent_ou.setValue(null);
							editor_pane_parent_ou.setDisplayedValue('');
							editor_pane_parent_ou.validate(false);
						} else {
							editor_pane_parent_ou.disabled = false;
							editor_pane_parent_ou.validate(true);
							editor_pane_parent_ou.setValue( this.store.getValue( current_ou, 'parent_ou' ) );
						}

						editor_pane_opac_visible.setChecked( this.store.getValue( current_ou, 'opac_visible' ) == 't' ? true : false );

						hoo_load();
						addr_load();
]]>
					</script>

					<script type="dojo/method" event="getLabel" args="item,pI">
						var label = this.store.getValue(item,'shortname') + ' : ' + this.store.getValue(item,'name');
						if (this.store.getValue(item,'ischanged') == 1) label = '* ' + label;
						return label;
					</script>

				</div>
			</div>

			<div jsId="right_pane" id="right_pane" dojoType="dijit.layout.ContentPane"  sizeShare="200">
				<script type="dojo/method">
					window.right_pane_toggler = new dojo.fx.Toggler({ node: 'right_pane'});
					window.right_pane_toggler.hide();
				</script>

				<div id="right_tabpane" dojoType="dijit.layout.TabContainer">
	
					<div id="editor_pane" dojoType="dijit.layout.ContentPane" title="&conify.org_unit.editor_pane.title;">

						<table class="tundra" style="margin:10px;">
							<tr>
								<th>&conify.org_unit.editor_pane.org_unit_name;</th>
								<td>
									<span id="editor_pane_name" dojoType="dijit.form.ValidationTextBox" jsId="editor_pane_name" regExp=".+" required="true">
										<script type="dojo/connect" event="onChange">
											if (current_ou) ou_list_store.setValue( current_ou, "name", this.getValue() );
										</script>
									</span>
									<span dojoType="openils.widget.TranslatorPopup" targetObject="current_fm_ou" field="name"></span>
								</td>
							</tr>
							<tr>
								<th>&conify.org_unit.editor_pane.org_unit_code;</th>
								<td>
									<span id="editor_pane_shortname" dojoType="dijit.form.ValidationTextBox" jsId="editor_pane_shortname" uppercase="true" regExp=".+" required="true">
										<script type="dojo/connect" event="onChange">
											if (current_ou) ou_list_store.setValue( current_ou, "shortname", this.getValue() );
										</script>
									</span>
								</td>
							</tr>
							<tr>
								<th>Routing Code</th>
								<td>
									<span id="editor_pane_routing_code" dojoType="dijit.form.TextBox" jsId="editor_pane_routing_code">
										<script type="dojo/connect" event="onChange">
											if (current_ou) ou_list_store.setValue( current_ou, "routing_code", this.getValue() );
										</script>
									</span>
								</td>
							</tr>
							<tr>
								<th>&conify.org_unit.editor_pane.main_email;</th>
								<td>
									<span id="editor_pane_email" dojoType="dijit.form.ValidationTextBox" jsId="editor_pane_email" regExp="[a-zA-Z0-9!#$%'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%'*+/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?">
										<script type="dojo/connect" event="onChange">
											if (current_ou) ou_list_store.setValue( current_ou, "email", this.getValue() );
										</script>
									</span>
								</td>
							</tr>
							<tr>
								<th>&conify.org_unit.editor_pane.main_phone;</th>
								<td>
									<span id="editor_pane_phone" dojoType="dijit.form.ValidationTextBox" jsId="editor_pane_phone" regExp="^(?:(?:\d{1}[ -\.])?\(?\d{3}\)?[ -\.]{1})?\d{3}[ -\.]{1}\d{4}(| \S+.*)$">
										<script type="dojo/connect" event="onChange">
											if (current_ou) ou_list_store.setValue( current_ou, "phone", this.getValue() );
										</script>
									</span>
								</td>
							</tr>
							<tr>
								<th>&conify.org_unit.editor_pane.org_unit_type;</th>
								<td>
									<div
									  id="editor_pane_ou_type"
									  dojoType="dijit.form.FilteringSelect"
									  jsId="editor_pane_ou_type"
									  store="ou_type_store"
									  searchAttr="name"
									  ignoreCase="true"
									  required="true"
									>
										<script type="dojo/method" event="onChange">
											if (current_ou) ou_list_store.setValue( current_ou, "ou_type", this.getValue() );
										</script>
									</div>
								</td>
							</tr>
							<tr>
								<th>&conify.org_unit.editor_pane.parent;</th>
								<td>
									<div
									  id="editor_pane_parent_ou"
									  dojoType="dijit.form.FilteringSelect"
									  jsId="editor_pane_parent_ou"
									  store="ou_list_store"
									  searchAttr="shortname"
									  ignoreCase="true"
									  required="true"
									>
										<script type="dojo/method" event="onChange">
<![CDATA[
											if (current_ou && this.getValue()) this.store.setValue( current_ou, "parent_ou", this.getValue() );
											if ( this.store.getValue( current_ou, '_trueRoot' ) == 'true' ) this.required = false;
											else this.required = true;
]]>
										</script>
									</div>
								</td>
							</tr>
							<tr>
								<th>&conify.org_unit.editor_pane.opac_visible;</th>
								<td>
									<input
									  id="editor_pane_opac_visible"
									  jsId="editor_pane_opac_visible"
									  type="checkbox"
									  dojoType="dijit.form.CheckBox"
									  onChange="if (current_ou) ou_list_store.setValue( current_ou, 'opac_visible', this.checked ? 't' : 'f' );"
									/>
								</td>
							</tr>
						</table>
	
						<div dojoType="dijit.layout.ContentPane" orientation="horizontal" style="margin-bottom: 20px;">
	
							<button jsId="save_ou_button" dojoType="dijit.form.Button" label="&conify.save_button.label;" onClick="save_org()">
								<script type="dojo/connect" event="startup">
									this.disabled = true;
								</script>
							</button>
	
							<button jsId="delete_ou_button" dojoType="dijit.form.Button" label="&conify.delete_button.label;">
								<script type="dojo/connect" event="startup">
									this.disabled = true;
								</script>
								<script type="dojo/connect" event="onClick">
<![CDATA[
									var old_name = ou_list_store.getValue( current_ou, 'name' );

									if (ou_list_store.getValue( current_ou, '_trueRoot' ) == 'true') {
										highlighter.editor_pane.red.play();
										status_update( dojo.string.substitute( aou_strings.ERROR_DELETING_LAST_AOU, [ou_list_store.getValue( current_ou, 'name' )] ) );
										return false;
									}

									if ( current_ou.children ) {
										var kids = current_ou.children;
										if (!dojo.isArray(kids)) kids = [kids];
	
										var existing_kids = dojo.filter(
											kids,
											function(kid){ return kid.isdeleted[0] != 1 }
										);
										if ( existing_kids.length > 0) {
											highlighter.editor_pane.red.play();
											status_update( dojo.string.substitute( aou_strings.ERROR_ORPHANS, [ou_list_store.getValue( current_ou, 'name' ), existing_kids.length] ) );
											return;
										}
									}
	
									if (confirm(dojo.string.substitute(aou_strings.CONFIRM_DELETE, [current_ou.name]))) {
										ou_list_store.setValue( current_ou, 'isdeleted', 1 );

										var modified_ou = new aou().fromStoreItem( current_ou );
										modified_ou.isdeleted( 1 );

										var objs = [];
										objs.push(modified_ou);
										if (!current_billing_address.isnew()) {
											current_billing_address.isdeleted( 1 );
											objs.push(current_billing_address);
										}

										if (!current_mailing_address.isnew()) {
											current_mailing_address.isdeleted( 1 );
											objs.push(current_mailing_address);
										}

										if (!current_holds_address.isnew()) {
											current_holds_address.isdeleted( 1 );
											objs.push(current_holds_address);
										}

										if (!current_ill_address.isnew()) {
											current_ill_address.isdeleted( 1 );
											objs.push(current_ill_address);
										}

										if (!current_ou_hoo.isnew()) {
											current_ou_hoo.isdeleted( 1 );
											objs.push(current_ou_hoo);
										}

										pcrud.apply(objs, {
											timeout : 10,
											onerror : function (r) {
												highlighter.editor_pane.red.play();
												status_update(dojo.string.substitute(aou_strings.ERROR_DELETING, [old_name]));
											},
											oncomplete : function (r) {
												new_kid_button.disabled = true;
												save_ou_button.disabled = true;
												delete_ou_button.disabled = true;

												var main_settings_fields = [ 'name', 'shortname', 'routing_code', 'email', 'phone', 'ou_type', 'parent_ou' ];
												for ( var i in main_settings_fields ) {
													var field = main_settings_fields[i];
													window["editor_pane_" + field].setValue( '' ); // unset the value
													window["editor_pane_" + field].setDisplayedValue( '' ); // unset the value
												}

												ou_list_store.fetch({
													query : { id : ou_list_store.getValue( current_ou, 'id' ) },
													queryOptions : { deep : true },
													onItem : function (item, req) { try { if (this.isItem( item )) this.deleteItem( item ); } catch (e) { } },
													scope : ou_list_store
												});

												current_billing_address = null;
												current_mailing_address = null;
												current_holds_address = null;
												current_ill_address = null;
												current_ou_hoo = null;
												current_ou = null;

												highlighter.editor_pane.green.play();
												status_update(dojo.string.substitute(aou_strings.STATUS_DELETED, [old_name]));
											}
										});
									}
]]>
								</script>
							</button>
	
						</div>
	
						<button jsId="new_kid_button" dojoType="dijit.form.Button" label="&conify.new_kid_button.label;">
							<script type="dojo/connect" event="startup">
								this.disabled = true;
							</script>
							<script type="dojo/connect" event="onClick">
<![CDATA[
								var new_fm_obj = new aou().fromHash({
									isnew			: 1,
									name			: aou_strings.LABEL_NEW_BRANCH + virgin_ou_id,
									opac_visible	: 'f',
									shortname		: ou_list_store.getValue( current_ou, 'shortname' ) + '-NEW' + virgin_ou_id--,
									routing_code		: ou_list_store.getValue( current_ou, 'routing_code' ),
									parent_ou		: ou_list_store.getValue( current_ou, 'id' ),
									ou_type			: ou_list_store.getValue( current_ou, 'ou_type' )
								});

								pcrud.create( new_fm_obj, {
									timeout : 10,
									onerror : function (r) {
										highlighter.editor_pane.red.play();
										status_update( aou_strings.ERROR_CREATING_CHILD_AOU );
									},
									oncomplete : function (r, list) {
										
										if ( list.length ) {
											ou_list_store.newItem(
												list[0].toHash(),
												{ parent : current_ou, attribute : 'children' }
											);
										} else {
											highlighter.editor_pane.red.play();
											status_update( aou_strings.ERROR_CREATING_CHILD_AOU );
										}
									}
								});
	
								highlighter.editor_pane.green.play();
								highlighter.ou_tree.green.play();
								status_update( dojo.string.substitute(aou_strings.SUCCESS_CREATING_CHILD_AOU, [ou_list_store.getValue( current_ou, 'name' )] ) );
]]>
							</script>
						</button>
	
					</div>

					<div id="hoo_pane" dojoType="dijit.layout.ContentPane" title="&conify.org_unit.hoo_pane.title;">
						<table class="tundra" style="margin:10px;">
							<tr><th></th><th>&conify.org_unit.hoo_pane.open_time;</th><th>&conify.org_unit.hoo_pane.close_time;</th></tr>
							<tr><th>&conify.org_unit.hoo_pane.monday;</th>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_0_open" onChange="set_hoo_thisvalue('dow_0_open', this.value);"></span></td>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_0_close" onChange="set_hoo_thisvalue('dow_0_close', this.value);"></span></td>
								<td><span dojoType="dijit.form.Button" label="&conify.org_unit.hoo_pane.closed;" onClick="dow_0_open.setValue( new Date('Tue Mar 25 2008 00:00:00') ); dow_0_close.setValue( new Date('Tue Mar 25 2008 00:00:00') );"></span></td>
							</tr>
							<tr><th>&conify.org_unit.hoo_pane.tuesday;</th>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_1_open" onChange="set_hoo_thisvalue('dow_1_open', this.value);"></span></td>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_1_close" onChange="set_hoo_thisvalue('dow_1_close', this.value);"></span></td>
								<td><span dojoType="dijit.form.Button" label="&conify.org_unit.hoo_pane.closed;" onClick="dow_1_open.setValue( new Date('Tue Mar 25 2008 00:00:00') ); dow_1_close.setValue( new Date('Tue Mar 25 2008 00:00:00') );"></span></td>
							</tr>
							<tr><th>&conify.org_unit.hoo_pane.wednesday;</th>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_2_open" onChange="set_hoo_thisvalue('dow_2_open', this.value);"></span></td>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_2_close" onChange="set_hoo_thisvalue('dow_2_close', this.value);"></span></td>
								<td><span dojoType="dijit.form.Button" label="&conify.org_unit.hoo_pane.closed;" onClick="dow_2_open.setValue( new Date('Tue Mar 25 2008 00:00:00') ); dow_2_close.setValue( new Date('Tue Mar 25 2008 00:00:00') );"></span></td>
							</tr>
							<tr><th>&conify.org_unit.hoo_pane.thursday;</th>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_3_open" onChange="set_hoo_thisvalue('dow_3_open', this.value);"></span></td>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_3_close" onChange="set_hoo_thisvalue('dow_3_close', this.value);"></span></td>
								<td><span dojoType="dijit.form.Button" label="&conify.org_unit.hoo_pane.closed;" onClick="dow_3_open.setValue( new Date('Tue Mar 25 2008 00:00:00') ); dow_3_close.setValue( new Date('Tue Mar 25 2008 00:00:00') );"></span></td>
							</tr>
							<tr><th>&conify.org_unit.hoo_pane.friday;</th>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_4_open" onChange="set_hoo_thisvalue('dow_4_open', this.value);"></span></td>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_4_close" onChange="set_hoo_thisvalue('dow_4_close', this.value);"></span></td>
								<td><span dojoType="dijit.form.Button" label="&conify.org_unit.hoo_pane.closed;" onClick="dow_4_open.setValue( new Date('Tue Mar 25 2008 00:00:00') ); dow_4_close.setValue( new Date('Tue Mar 25 2008 00:00:00') );"></span></td>
							</tr>
							<tr><th>&conify.org_unit.hoo_pane.saturday;</th>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_5_open" onChange="set_hoo_thisvalue('dow_5_open', this.value);"></span></td>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_5_close" onChange="set_hoo_thisvalue('dow_5_close', this.value);"></span></td>
								<td><span dojoType="dijit.form.Button" label="&conify.org_unit.hoo_pane.closed;" onClick="dow_5_open.setValue( new Date('Tue Mar 25 2008 00:00:00') ); dow_5_close.setValue( new Date('Tue Mar 25 2008 00:00:00') );"></span></td>
							</tr>
							<tr><th>&conify.org_unit.hoo_pane.sunday;</th>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_6_open" onChange="set_hoo_thisvalue('dow_6_open', this.value);"></span></td>
								<td><span dojoType="dijit.form.TimeTextBox" style="width:8em;" jsId="dow_6_close" onChange="set_hoo_thisvalue('dow_6_close', this.value);"></span></td>
								<td><span dojoType="dijit.form.Button" label="&conify.org_unit.hoo_pane.closed;" onClick="dow_6_open.setValue( new Date('Tue Mar 25 2008 00:00:00') ); dow_6_close.setValue( new Date('Tue Mar 25 2008 00:00:00') );"></span></td>
							</tr>
						</table>
	
						<button jsId="save_hoo_button" dojoType="dijit.form.Button" label="&conify.save_button.label;">
                            <script type="dojo/connect" event="startup">
                                this.disabled = true;
                            </script>
							<script type="dojo/connect" event="onClick">
<![CDATA[
                                if (!current_ou_hoo.isnew()) {
                                    current_ou_hoo.ischanged( 1 );
                                }

                                pcrud.apply( current_ou_hoo, {
                                    timeout : 10,
                                    onerror : function (r) {
                                        highlighter.hoo_pane.red.play();
                                        status_update( dojo.string.substitute( aou_strings.ERROR_SAVING_HOO, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                    },
                                    oncomplete : function (r) {
                                        current_ou_hoo.isnew( 0 );
                                        current_ou_hoo.ischanged( 0 );
                                        highlighter.hoo_pane.green.play();
                                        status_update( dojo.string.substitute( aou_strings.SUCCESS_SAVING_HOO, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                    },
                                });
]]>
							</script>
						</button>
	
					</div>
	
					<div id="addresses_pane" dojoType="dijit.layout.ContentPane" title="&conify.org_unit.addresses_pane.title;">
						
						<div id="billing_address_pane" dojoType="dijit.layout.TabContainer" style="margin-top:10px">
	
							<script type="dojo/method">
								current_billing_address = null;
								current_mailing_address = null;
								current_holds_address = null;
								current_ill_address = null;
							</script>
	
							<div id="billing_address" dojoType="dijit.layout.ContentPane" title="&conify.org_unit.addresses_pane.physical.title;">
								<table class="tundra" style="margin:10px;">
									<tr>
										<th>&conify.org_unit.addresses_pane.type;</th>
										<td colspan="3">
											<span jsId="billing_addr_type" style="width:100%;" dojoType="dijit.form.TextBox" onChange="current_billing_address.address_type( this.getValue() )"></span>
										</td>
										<th>&conify.org_unit.addresses_pane.valid;</th><td>
											<input
											  type="checkbox"
											  jsId="billing_addr_valid"
											  dojoType="dijit.form.CheckBox"
											  value='t'
											  onChange="if (current_billing_address) current_billing_address.valid( this.checked ? 't' : 'f' );"
											/>
										</td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.street1;</th><td colspan="5"><span jsId="billing_addr_street1" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_billing_address.street1( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.street2;</th><td colspan="5"><span jsId="billing_addr_street2" style="width:100%;" dojoType="dijit.form.TextBox" onChange="current_billing_address.street2( this.getValue() )"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.city;</th><td><span jsId="billing_addr_city" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_billing_address.city( this.getValue() )" required="true"></span></td>
										<th>&conify.org_unit.addresses_pane.state;</th><td><span jsId="billing_addr_state" style="width:100%;" dojoType="dijit.form.ValidationTextBox" size="2" maxSize="2" uppercase="true" onChange="current_billing_address.state( this.getValue() )"></span></td>
										<th>&conify.org_unit.addresses_pane.zip;</th><td><span jsId="billing_addr_post_code" style="width:100%;" dojoType="dijit.form.ValidationTextBox" size="10" maxSize="10" regExp="^\d{5}(?:-\d{4})?$" uppercase="true" onChange="current_billing_address.post_code( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.country;</th><td colspan="2"><span jsId="billing_addr_country" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_billing_address.country( this.getValue() )" required="true"></span></td>
										<th>&conify.org_unit.addresses_pane.county;</th><td colspan="2"><span jsId="billing_addr_county" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_billing_address.county( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.san;</th><td colspan="2"><span jsId="billing_addr_san" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_billing_address.san( this.getValue() )" required="true"></span></td>
									</tr>
								</table>
	
								<button jsId="save_billing_address" dojoType="dijit.form.Button" label="&conify.save_button.label;">
									<script type="dojo/connect" event="startup">
										this.disabled = true;
									</script>
									<script type="dojo/connect" event="onClick">
<![CDATA[
                                        if (!current_billing_address.isnew()) {
                                            current_billing_address.ischanged( 1 );
                                        }

                                        pcrud.apply( current_billing_address, {
                                            timeout : 10,
                                            onerror : function (r) {
                                                highlighter.addresses_pane.red.play();
                                                status_update( dojo.string.substitute( aou_strings.ERROR_SAVING_PHYSICAL, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                            },
                                            oncomplete : function (r, list) {
                                                if (list[0] && (current_billing_address.isnew() == 1)) {
                                                    current_billing_address = list[0];

                                                    ou_list_store.setValue( current_ou, "billing_address", current_billing_address.id());
                                                    save_org();
                                                }
                                                current_billing_address.isnew( 0 );
                                                current_billing_address.ischanged( 0 );
                                                highlighter.addresses_pane.green.play();
                                                status_update( dojo.string.substitute( aou_strings.SUCCESS_SAVING_PHYSICAL, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                            },
                                        });
]]>
									</script>
								</button>
							</div>

							<div id="holds_address" dojoType="dijit.layout.ContentPane" title="&conify.org_unit.addresses_pane.holds.title;">
								<table class="tundra" style="margin:10px;">
									<tr>
										<th>&conify.org_unit.addresses_pane.type;</th><td colspan="3"><span jsId="holds_addr_type" style="width:100%;" dojoType="dijit.form.TextBox" onChange="current_holds_address.address_type( this.getValue() )"></span></td>
										<th>&conify.org_unit.addresses_pane.valid;</th><td>
											<input
											  type="checkbox"
											  jsId="holds_addr_valid"
											  dojoType="dijit.form.CheckBox"
											  value='t'
											  onChange="if (current_holds_address) current_holds_address.valid( this.checked ? 't' : 'f' );"
											/>
										</td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.street1;</th><td colspan="5"><span jsId="holds_addr_street1" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_holds_address.street1( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.street2;</th><td colspan="5"><span jsId="holds_addr_street2" style="width:100%;" dojoType="dijit.form.TextBox" onChange="current_holds_address.street2( this.getValue() )"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.city;</th><td><span jsId="holds_addr_city" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_holds_address.city( this.getValue() )" required="true"></span></td>
										<th>&conify.org_unit.addresses_pane.state;</th><td><span jsId="holds_addr_state" style="width:100%;" dojoType="dijit.form.ValidationTextBox" size="2" maxSize="2" uppercase="true" onChange="current_holds_address.state( this.getValue() )"></span></td>
										<th>&conify.org_unit.addresses_pane.zip;</th><td><span jsId="holds_addr_post_code" style="width:100%;" dojoType="dijit.form.ValidationTextBox" size="10" maxSize="10" regExp="^\d{5}(?:-\d{4})?$" uppercase="true" onChange="current_holds_address.post_code( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.country;</th><td colspan="2"><span jsId="holds_addr_country" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_holds_address.country( this.getValue() )" required="true"></span></td>
										<th>&conify.org_unit.addresses_pane.county;</th><td colspan="2"><span jsId="holds_addr_county" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_holds_address.county( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.san;</th><td colspan="2"><span jsId="holds_addr_san" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_holds_address.san( this.getValue() )" required="true"></span></td>
									</tr>
								</table>
	
								<button jsId="save_holds_address" dojoType="dijit.form.Button" label="&conify.save_button.label;">
									<script type="dojo/connect" event="startup">
										this.disabled = true;
									</script>
									<script type="dojo/connect" event="onClick">
<![CDATA[
                                        if (!current_holds_address.isnew()) {
                                            current_holds_address.ischanged( 1 );
                                        }

                                        pcrud.apply( current_holds_address, {
                                            timeout : 10,
                                            onerror : function (r) {
                                                highlighter.addresses_pane.red.play();
                                                status_update( dojo.string.substitute( aou_strings.ERROR_SAVING_HOLDS, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                            },
                                            oncomplete : function (r, list) {
                                                if (list[0] && (current_holds_address.isnew() == 1)) {
                                                    current_holds_address = list[0];

                                                    ou_list_store.setValue( current_ou, "holds_address", current_holds_address.id());
                                                    save_org();
                                                }
                                                current_holds_address.isnew( 0 );
                                                current_holds_address.ischanged( 0 );
                                                highlighter.addresses_pane.green.play();
                                                status_update( dojo.string.substitute( aou_strings.SUCCESS_SAVING_HOLDS, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                            },
                                        });
]]>
									</script>
								</button>
							</div>

							<div id="mailing_address" dojoType="dijit.layout.ContentPane" title="&conify.org_unit.addresses_pane.mailing.title;">
								<table class="tundra" style="margin:10px;">
									<tr>
										<th>&conify.org_unit.addresses_pane.type;</th><td colspan="3"><span jsId="mailing_addr_type" style="width:100%;" dojoType="dijit.form.TextBox" onChange="current_mailing_address.address_type( this.getValue() )"></span></td>
										<th>&conify.org_unit.addresses_pane.valid;</th><td>
											<input
											  type="checkbox"
											  jsId="mailing_addr_valid"
											  dojoType="dijit.form.CheckBox"
											  onChange="if (current_mailing_address) current_mailing_address.valid( this.checked ? 't' : 'f' );"
											/>
										</td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.street1;</th><td colspan="5"><span jsId="mailing_addr_street1" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_mailing_address.street1( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.street2;</th><td colspan="5"><span jsId="mailing_addr_street2" style="width:100%;" dojoType="dijit.form.TextBox" onChange="current_mailing_address.street2( this.getValue() )"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.city;</th><td><span jsId="mailing_addr_city" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_mailing_address.city( this.getValue() )" required="true"></span></td>
										<th>&conify.org_unit.addresses_pane.state;</th><td><span jsId="mailing_addr_state" style="width:100%;" dojoType="dijit.form.ValidationTextBox" size="2" maxSize="2" uppercase="true" onChange="current_mailing_address.state( this.getValue() )"></span></td>
										<th>&conify.org_unit.addresses_pane.zip;</th><td><span jsId="mailing_addr_post_code" style="width:100%;" dojoType="dijit.form.ValidationTextBox" size="10" maxSize="10" regExp="^\d{5}(?:-\d{4})?$" uppercase="true" onChange="current_mailing_address.post_code( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.country;</th><td colspan="2"><span jsId="mailing_addr_country" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_mailing_address.country( this.getValue() )" required="true"></span></td>
										<th>&conify.org_unit.addresses_pane.county;</th><td colspan="2"><span jsId="mailing_addr_county" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_mailing_address.county( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.san;</th><td colspan="2"><span jsId="mailing_addr_san" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_mailing_address.san( this.getValue() )" required="true"></span></td>
									</tr>
								</table>
	
								<button jsId="save_mailing_address" dojoType="dijit.form.Button" label="&conify.save_button.label;">
									<script type="dojo/connect" event="startup">
										this.disabled = true;
									</script>
									<script type="dojo/connect" event="onClick">
<![CDATA[
                                        if (!current_mailing_address.isnew()) {
                                            current_mailing_address.ischanged( 1 );
                                        }

                                        pcrud.apply( current_mailing_address, {
                                            timeout : 10,
                                            onerror : function (r) {
                                                highlighter.addresses_pane.red.play();
                                                status_update( dojo.string.substitute( aou_strings.ERROR_SAVING_MAILING, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                            },
                                            oncomplete : function (r, list) {
                                                if (list[0] && (current_mailing_address.isnew() == 1)) {
                                                    current_mailing_address = list[0];

                                                    ou_list_store.setValue( current_ou, "mailing_address", current_mailing_address.id());
                                                    save_org();
                                                }
                                                current_mailing_address.isnew( 0 );
                                                current_mailing_address.ischanged( 0 );
                                                highlighter.addresses_pane.green.play();
                                                status_update( dojo.string.substitute( aou_strings.SUCCESS_SAVING_MAILING, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                            },
                                        });
]]>
									</script>
								</button>
							</div>

							<div id="ill_address" dojoType="dijit.layout.ContentPane" title="&conify.org_unit.addresses_pane.ill.title;">
								<table class="tundra" style="margin:10px;">
									<tr>
										<th>&conify.org_unit.addresses_pane.type;</th><td colspan="3"><span jsId="ill_addr_type" style="width:100%;" dojoType="dijit.form.TextBox" onChange="current_ill_address.address_type( this.getValue() )"></span></td>
										<th>&conify.org_unit.addresses_pane.valid;</th><td>
											<input
											  type="checkbox"
											  jsId="ill_addr_valid"
											  dojoType="dijit.form.CheckBox"
											  onChange="if (current_ill_address) current_ill_address.valid( this.checked ? 't' : 'f' );"
											/>
										</td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.street1;</th><td colspan="5"><span jsId="ill_addr_street1" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_ill_address.street1( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.street2;</th><td colspan="5"><span jsId="ill_addr_street2" style="width:100%;" dojoType="dijit.form.TextBox" onChange="current_ill_address.street2( this.getValue() )"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.city;</th><td><span jsId="ill_addr_city" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_ill_address.city( this.getValue() )" required="true"></span></td>
										<th>&conify.org_unit.addresses_pane.state;</th><td><span jsId="ill_addr_state" style="width:100%;" dojoType="dijit.form.ValidationTextBox" size="2" maxSize="2" uppercase="true" onChange="current_ill_address.state( this.getValue() )"></span></td>
										<th>&conify.org_unit.addresses_pane.zip;</th><td><span jsId="ill_addr_post_code" style="width:100%;" dojoType="dijit.form.ValidationTextBox" size="10" maxSize="10" regExp="^\d{5}(?:-\d{4})?$" uppercase="true" onChange="current_ill_address.post_code( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.country;</th><td colspan="2"><span jsId="ill_addr_country" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_ill_address.country( this.getValue() )" required="true"></span></td>
										<th>&conify.org_unit.addresses_pane.county;</th><td colspan="2"><span jsId="ill_addr_county" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_ill_address.county( this.getValue() )" required="true"></span></td>
									</tr>
									<tr>
										<th>&conify.org_unit.addresses_pane.san;</th><td colspan="2"><span jsId="ill_addr_san" style="width:100%;" dojoType="dijit.form.ValidationTextBox" onChange="current_ill_address.san( this.getValue() )" required="true"></span></td>
									</tr>
								</table>
	
								<button jsId="save_ill_address" dojoType="dijit.form.Button" label="&conify.save_button.label;">
									<script type="dojo/connect" event="startup">
										this.disabled = true;
									</script>
									<script type="dojo/connect" event="onClick">
<![CDATA[
                                        if (!current_ill_address.isnew()) {
                                            current_ill_address.ischanged( 1 );
                                        }

                                        pcrud.apply( current_ill_address, {
                                            timeout : 10,
                                            onerror : function (r) {
                                                highlighter.addresses_pane.red.play();
                                                status_update( dojo.string.substitute( aou_strings.ERROR_SAVING_ILL, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                            },
                                            oncomplete : function (r, list) {
                                                if (list[0] && (current_ill_address.isnew() == 1)) {
                                                    current_ill_address = list[0];

                                                    ou_list_store.setValue( current_ou, "ill_address", current_ill_address.id());
                                                    save_org();
                                                }
                                                current_ill_address.isnew( 0 );
                                                current_ill_address.ischanged( 0 );
                                                highlighter.addresses_pane.green.play();
                                                status_update( dojo.string.substitute( aou_strings.SUCCESS_SAVING_ILL, [ou_list_store.getValue( current_ou, 'name' )] ) );
                                            },
                                        });
]]>
									</script>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div id="status_bar"><span style="font-weight: bold; margin: 5px; margin-right: 10px;">&conify.org_unit.status_bar;</span><span id="current_ou_name"></span></div>
	</body>
</html>
